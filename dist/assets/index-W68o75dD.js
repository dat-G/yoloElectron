import{y as v,o as h,z as n,c as F,Y as H,F as A,a4 as l,D as c,a as p,E as e,A as y,G as b,u as f,r as W,ad as X}from"./vue-6xqBoIdE.js";import{L as z,M as N,O as R,P as B,Q as j,R as V,S as Z,T as G,U as q,V as U,W as K,X as Q,Y as J}from"./element-plus-3UrSnVtZ.js";import"./lodash-S0Y0Up6J.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const P=(t,a)=>{const r=t.__vccOpts||t;for(const[s,o]of a)r[s]=o;return r},ee={name:"ModelPath",props:["path"],data(){return{}},methods:{}};function te(t,a,r,s,o,i){const d=l("el-breadcrumb-item"),u=l("el-breadcrumb");return h(),v(u,{separator:"/"},{default:n(()=>[(h(!0),F(A,null,H(r.path,(m,_)=>(h(),v(d,{key:_},{default:n(()=>[c(z(m),1)]),_:2},1024))),128))]),_:1})}const D=P(ee,[["render",te]]),ne={class:"flex items-center"},se={class:"flex items-center"},oe={class:"extraControl ml-4"},ae={name:"AppHeader",components:{ModelPath:D},data(){return{path:[]}},async mounted(){try{const t=await window.electronAPI.getAppConfig();this.path=t.app.model_path.split("/")}catch(t){console.error("配置获取失败:",t),this.path=["默认模型"]}}},ie=Object.assign(ae,{setup(t){return(a,r)=>{const s=l("el-avatar"),o=l("el-tag"),i=l("el-button"),d=l("el-page-header");return h(),v(d,{icon:null,id:"headerContainer",title:"YOLO Predict"},{content:n(()=>[p("div",ne,[e(s,{size:32,class:"mr-3",src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}),e(D,{path:a.path},null,8,["path"]),e(o,null,{default:n(()=>r[0]||(r[0]=[c("Default")])),_:1})])]),extra:n(()=>[p("div",se,[p("div",oe,[e(i,null,{default:n(()=>r[1]||(r[1]=[c("Print")])),_:1}),e(i,{type:"primary",class:"ml-2"},{default:n(()=>r[2]||(r[2]=[c("Edit")])),_:1})])])]),_:1})}}}),re={name:"YOLOPredictor",props:["imageSrc"],data(){return{predictions:[]}},dev:{},methods:{async detect(t){const a=new FormData,r=await fetch(this.imageSrc).then(s=>s.blob());a.append("image",r,"image.jpg");try{const s=await fetch("/yolo-detect/predict",{method:"POST",headers:{Accept:"application/json"},body:a});return this.predictions=await s.json(),console.log("原始预测数据:",this.predictions),this.drawBoxes(t),this.predictions}catch(s){return console.error("Prediction error:",s),[]}},async drawBoxes(t){const a=t.getContext("2d"),{width:r,height:s}=t;console.log("Canvas尺寸:",t.width,t.height),console.log("预测数据:",this.predictions);for(const o of this.predictions){console.log("预测框详情:",`类别:${o.class} 置信度:${o.confidence}`,`坐标:${o.bbox}`);const[i,d,u,m]=o.bbox,_=new Image;_.src=this.imageSrc,await new Promise(T=>{_.onload=T});const $=_.naturalWidth,x=_.naturalHeight;console.log("原始图像尺寸:",$,x);const C=t.width/$,L=t.height/x,g=i*C,w=d*L,E=u*C,O=m*L;a.lineWidth=5,a.strokeStyle="#FF3030",a.strokeRect(g,w,E,O),console.log("绘制框坐标:",g,w,E,O),a.fillStyle="#FF3030",a.font="14px Courier";const S=`${o.class} (${Math.round(o.confidence*100)}%)`,M=a.measureText(S).width,k=2;a.fillRect(g-k,(w>10?w-5:15)-16+k,M+k*2,16+k*2),a.fillStyle="#FFFFFF",a.fillText(S,g,w>10?w-5:15)}}}};function le(t,a,r,s,o,i){return null}const I=P(re,[["render",le]]),de={style:{height:"100%",position:"relative"},class:"previewArea"},ce={ref:"previewCanvas",style:{width:"100%",height:"100%","object-fit":"contain"}},pe={class:"float-control-Right"},ue={class:"float-control-Left"},fe={name:"AppMain",components:{YoloPredictor:I},data(){return{showPreview:!1,previewImage:null,errorMessage:"无图片",isPredicting:!1,predictions:[],scale:1,baseWidth:0,baseHeight:0,dragging:!1,startX:0,startY:0,offsetX:0,offsetY:0}},mounted(){const t=this.$refs.previewCanvas;t.addEventListener("wheel",this.handleWheel,{passive:!1}),t.addEventListener("mousedown",this.startDragging),t.addEventListener("mousemove",this.drag),t.addEventListener("mouseup",this.stopDragging),t.addEventListener("mouseleave",this.stopDragging),window.addEventListener("resize",this.handleResize),t.addEventListener("mousemove",this.handleCanvasHover),t.addEventListener("click",this.handleCanvasClick)},beforeDestroy(){const t=this.$refs.previewCanvas;t.removeEventListener("wheel",this.handleWheel),t.removeEventListener("mousedown",this.startDragging),t.removeEventListener("mousemove",this.drag),t.removeEventListener("mouseup",this.stopDragging),t.removeEventListener("mouseleave",this.stopDragging),window.removeEventListener("resize",this.handleResize),t.removeEventListener("mousemove",this.handleCanvasHover),t.removeEventListener("click",this.handleCanvasClick)},methods:{startDragging(t){this.dragging=!0,this.startX=t.clientX-this.offsetX,this.startY=t.clientY-this.offsetY},drag(t){this.dragging&&(this.offsetX=t.clientX-this.startX,this.offsetY=t.clientY-this.startY,this.applyTransform())},stopDragging(){this.dragging=!1},applyTransform(){const t=this.$refs.previewCanvas;t.style.transform=`translate(${this.offsetX}px, ${this.offsetY}px)`},handleOpenClick(){this.$refs.fileInput.click()},handleZoomIn(){this.scale=Math.min(this.scale*1.2,3),this.updateCanvasSize()},handleZoomOut(){this.scale=Math.max(parseFloat((this.scale*.8).toFixed(2)),.2),this.updateCanvasSize()},updateCanvasSize(){const t=this.$refs.previewCanvas,a=50,r=Math.max(this.baseWidth*this.scale,a),s=Math.max(this.baseHeight*this.scale,a);t.style.width=`${r}px`,t.style.height=`${s}px`,this.$refs.predictor.drawBoxes(t)},async handleFileChange(t){const a=t.target.files[0];if(a){this.errorCheck=!1;const r=new FileReader;r.onload=s=>{const o=new Image;o.onload=()=>{this.baseWidth=o.naturalWidth,this.baseHeight=o.naturalHeight;const i=this.$refs.previewCanvas;i.width=o.naturalWidth,i.height=o.naturalHeight,i.getContext("2d").drawImage(o,0,0,i.width,i.height),this.showPreview=!0,this.previewImage=s.target.result,this.$nextTick(()=>{this.$refs.predictor.detect(i)})},o.src=s.target.result},r.onerror=s=>{this.errorMessage=`文件加载失败: ${s.target.error.name}`,this.showPreview=!1},this.errorCheck||r.readAsDataURL(a)}},handleImageError(t){this.errorMessage="图片加载失败",this.showPreview=!1},handleImageLoad(){this.$nextTick(()=>{const t=this.$refs.previewImageRef.$el.querySelector("img");t&&this.$refs.predictor&&(t.onload=()=>{this.$refs.predictor.detect(t)},t.complete&&this.$refs.predictor.detect(t))})}}},he=Object.assign(fe,{setup(t){return(a,r)=>{const s=l("el-button"),o=l("el-empty"),i=l("el-icon"),d=l("el-button-group"),u=l("el-affix");return h(),F(A,null,[p("div",de,[y(p("canvas",ce,null,512),[[b,a.showPreview]]),y(e(o,{class:"image-placeholder",description:a.errorMessage,style:{height:"100%"}},{default:n(()=>[e(s,{type:"primary",onClick:a.handleOpenClick},{default:n(()=>r[1]||(r[1]=[c("打开")])),_:1},8,["onClick"]),p("input",{ref:"fileInput",type:"file",hidden:"",onChange:r[0]||(r[0]=(...m)=>a.handleFileChange&&a.handleFileChange(...m))},null,544)]),_:1},8,["description"]),[[b,!a.showPreview]]),y(e(I,{ref:"predictor","image-src":a.previewImage},null,8,["image-src"]),[[b,a.showPreview]])]),y(p("div",pe,[e(u,{position:"bottom",offset:130},{default:n(()=>[e(d,{class:"picControl"},{default:n(()=>[e(s,{circle:"",onClick:a.handleZoomIn},{default:n(()=>[e(i,null,{default:n(()=>[e(f(N))]),_:1})]),_:1},8,["onClick"]),e(s,{type:"primary",circle:"",onClick:a.handleZoomOut},{default:n(()=>[e(i,null,{default:n(()=>[e(f(R))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})],512),[[b,a.showPreview]]),y(p("div",ue,[e(u,{position:"bottom",offset:130},{default:n(()=>[e(d,{class:"picControl"},{default:n(()=>[e(s,{circle:"",onClick:a.handleOpenClick},{default:n(()=>[e(i,null,{default:n(()=>[e(f(B))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})],512),[[b,a.showPreview]])],64)}}}),me={style:{display:"inline-flex","align-items":"center"}},_e={name:"AppFooter"},ge=Object.assign(_e,{setup(t){return(a,r)=>{const s=l("el-statistic"),o=l("el-col"),i=l("el-icon"),d=l("el-row");return h(),v(d,null,{default:n(()=>[e(o,{span:6},{default:n(()=>[e(s,{title:"Daily active users",value:268500})]),_:1}),e(o,{span:6},{default:n(()=>[e(s,{value:138},{title:n(()=>[p("div",me,[r[0]||(r[0]=c(" Ratio of men to women ")),e(i,{style:{"margin-left":"4px"},size:12},{default:n(()=>[e(f(j))]),_:1})])]),suffix:n(()=>r[1]||(r[1]=[c("/100")])),_:1})]),_:1}),e(o,{span:6},{default:n(()=>[e(s,{title:"Total Transactions",value:172e3})]),_:1}),e(o,{span:6},{default:n(()=>[e(s,{title:"Feedback number",value:562},{suffix:n(()=>[e(i,{style:{"vertical-align":"-0.125em"}},{default:n(()=>[e(f(V))]),_:1})]),_:1})]),_:1})]),_:1})}}}),ve=P(ge,[["__scopeId","data-v-7650e6c7"]]),we={__name:"SideBar",setup(t){const a=W(!0);return(r,s)=>{const o=l("el-icon"),i=l("el-menu-item"),d=l("el-menu-item-group"),u=l("el-sub-menu"),m=l("el-menu");return h(),v(m,{"default-active":"2",id:"sidebarContainer",collapse:a.value,"collapse-transition":!0},{default:n(()=>[e(u,{index:"1"},{title:n(()=>[e(o,null,{default:n(()=>[e(f(Z))]),_:1}),s[1]||(s[1]=p("span",null,"Navigator One",-1))]),default:n(()=>[e(d,null,{title:n(()=>s[2]||(s[2]=[p("span",null,"Group One",-1)])),default:n(()=>[e(i,{index:"1-1"},{default:n(()=>s[3]||(s[3]=[c("item one")])),_:1}),e(i,{index:"1-2"},{default:n(()=>s[4]||(s[4]=[c("item two")])),_:1})]),_:1}),e(d,{title:"Group Two"},{default:n(()=>[e(i,{index:"1-3"},{default:n(()=>s[5]||(s[5]=[c("item three")])),_:1})]),_:1}),e(u,{index:"1-4"},{title:n(()=>s[6]||(s[6]=[p("span",null,"item four",-1)])),default:n(()=>[e(i,{index:"1-4-1"},{default:n(()=>s[7]||(s[7]=[c("item one")])),_:1})]),_:1})]),_:1}),e(i,{index:"2"},{title:n(()=>s[8]||(s[8]=[c("Navigator Two")])),default:n(()=>[e(o,null,{default:n(()=>[e(f(G))]),_:1})]),_:1}),e(i,{index:"3",disabled:""},{title:n(()=>s[9]||(s[9]=[c("Navigator Three")])),default:n(()=>[e(o,null,{default:n(()=>[e(f(q))]),_:1})]),_:1}),e(i,{index:"4"},{title:n(()=>s[10]||(s[10]=[c("Navigator Four")])),default:n(()=>[e(o,null,{default:n(()=>[e(f(U))]),_:1})]),_:1}),s[11]||(s[11]=p("div",{class:"flexgrow"},null,-1)),e(i,{index:"5",class:"fixed-bottom expand-switch",onClick:s[0]||(s[0]=_=>a.value=!a.value)},{default:n(()=>[e(o,null,{default:n(()=>[a.value?(h(),v(f(K),{key:0})):(h(),v(f(Q),{key:1}))]),_:1})]),_:1})]),_:1},8,["collapse"])}}};console.log('👋 This message is being logged by "App.vue", included via Vite');const ye={name:"App",components:{AppHeader:ie,AppMain:he,AppFooter:ve,SideBar:we}},be={class:"common-layout"};function $e(t,a,r,s,o,i){const d=l("side-bar"),u=l("el-aside"),m=l("app-header"),_=l("el-header"),$=l("app-main"),x=l("el-main"),C=l("app-footer"),L=l("el-footer"),g=l("el-container");return h(),F("div",be,[e(g,null,{default:n(()=>[e(u,{style:{width:"auto"}},{default:n(()=>[e(d)]),_:1}),e(g,null,{default:n(()=>[e(_,{id:"appHeader"},{default:n(()=>[e(m)]),_:1}),e(x,null,{default:n(()=>[e($)]),_:1}),e(L,{height:"auto",style:{margin:"10px","padding-bottom":"10px"}},{default:n(()=>[e(C)]),_:1})]),_:1})]),_:1})])}const xe=P(ye,[["render",$e]]),Y=X(xe);Y.use(J);Y.mount("#app");
