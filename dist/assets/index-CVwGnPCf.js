import{y as $,o as w,z as i,c as z,Y as B,F as E,a4 as d,D as v,a as _,E as t,A as D,G as I,u as y,r as L,L as X,b as N,ad as Z}from"./vue-O2VO_XZ7.js";import{L as U,M as q,O as G,P as K,Q,R as J,S as ee,T as te,U as se,V as ie,W as ne,X as oe}from"./element-plus-CavdJ0tW.js";import"./lodash-S0Y0Up6J.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const O=(e,s)=>{const a=e.__vccOpts||e;for(const[l,n]of s)a[l]=n;return a},ae={name:"ModelPath",props:["path"],data(){return{}},methods:{}};function le(e,s,a,l,n,o){const r=d("el-breadcrumb-item"),p=d("el-breadcrumb");return w(),$(p,{separator:"/"},{default:i(()=>[(w(!0),z(E,null,B(a.path,(h,f)=>(w(),$(r,{key:f},{default:i(()=>[v(U(h),1)]),_:2},1024))),128))]),_:1})}const A=O(ae,[["render",le]]),re={class:"flex items-center"},de={class:"flex items-center"},ce={class:"extraControl ml-4"},ue={name:"AppHeader",components:{ModelPath:A},data(){return{path:[]}},async mounted(){try{const e=await window.electronAPI.getAppConfig();this.path=e.app.model_path.split("/")}catch(e){console.error("配置获取失败:",e),this.path=["默认模型"]}}},W=Object.assign(ue,{setup(e){return(s,a)=>{const l=d("el-avatar"),n=d("el-tag"),o=d("el-button"),r=d("el-page-header");return w(),$(r,{icon:null,id:"headerContainer",title:"YOLO Predict"},{content:i(()=>[_("div",re,[t(l,{size:32,class:"mr-3",src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}),t(A,{path:s.path},null,8,["path"]),t(n,null,{default:i(()=>a[0]||(a[0]=[v("Default")])),_:1})])]),extra:i(()=>[_("div",de,[_("div",ce,[t(o,null,{default:i(()=>a[1]||(a[1]=[v("Print")])),_:1}),t(o,{type:"primary",class:"ml-2"},{default:i(()=>a[2]||(a[2]=[v("Edit")])),_:1})])])]),_:1})}}}),pe={name:"YOLOPredictor",props:{imageSrc:{type:String,default:null}},watch:{imageSrc:{handler(e){e&&(console.log("YoloPredictor 接收到新图片:",e),this.detectImage())},immediate:!0}},data(){return{predictions:[]}},dev:{},methods:{detectImage(){if(!this.imageSrc)return;const e=new Image;e.onload=()=>{this.detect(e)},e.src=this.imageSrc},async detect(e){const s=new FormData,a=await fetch(this.imageSrc).then(l=>l.blob());s.append("image",a,"image.jpg");try{const l=await fetch("/yolo-detect/predict",{method:"POST",headers:{Accept:"application/json"},body:s});this.predictions=await l.json(),console.log("原始预测数据:",this.predictions);const n=this.predictions.length;return this.$emit("prediction-update",n),console.log("预测框数量:",n),this.drawBoxes(e),this.predictions}catch(l){return console.error("Prediction error:",l),[]}},async drawBoxes(e){const s=e.getContext("2d"),{width:a,height:l}=e;console.log("Canvas尺寸:",e.width,e.height);for(const n of this.predictions){const[o,r,p,h]=n.bbox,f=new Image;f.src=this.imageSrc,await new Promise(R=>{f.onload=R});const x=f.naturalWidth,u=f.naturalHeight;console.log("原始图像尺寸:",x,u);const c=e.width/x,g=e.height/u,b=o*c,C=r*g,S=p*c,P=h*g;s.lineWidth=5,s.strokeStyle="#FF3030",s.strokeRect(b,C,S,P),s.fillStyle="#FF3030",s.font="14px Courier";const F=`${n.class} (${Math.round(n.confidence*100)}%)`,m=s.measureText(F).width,k=2;s.fillRect(b-k,(C>10?C-5:15)-16+k,m+k*2,16+k*2),s.fillStyle="#FFFFFF",s.fillText(F,b,C>10?C-5:15)}}}};function he(e,s,a,l,n,o){return null}const j=O(pe,[["render",he]]),me={style:{height:"100%",position:"relative"},class:"previewArea"},fe={ref:"previewCanvas",style:{width:"100%",height:"100%","object-fit":"contain"}},ge={class:"float-control-Right"},_e={class:"float-control-Left"},ve={components:{YoloPredictor:j},props:{selectedFile:{type:Object,default:null}},emits:["image-size-update","prediction-update"],data(){return{showPreview:!1,previewImage:null,errorMessage:"无图片",isPredicting:!1,predictions:[],scale:1,baseWidth:0,baseHeight:0,dragging:!1,startX:0,startY:0,offsetX:0,offsetY:0,boxCount:0}},watch:{selectedFile(e){e&&(console.log("Main接收到新图片:",e),this.simulateFileSelection(e))}},mounted(){const e=this.$refs.previewCanvas;e.addEventListener("wheel",this.handleWheel,{passive:!1}),e.addEventListener("mousedown",this.startDragging),e.addEventListener("mousemove",this.drag),e.addEventListener("mouseup",this.stopDragging),e.addEventListener("mouseleave",this.stopDragging),window.addEventListener("resize",this.handleResize),e.addEventListener("mousemove",this.handleCanvasHover),e.addEventListener("click",this.handleCanvasClick)},beforeDestroy(){const e=this.$refs.previewCanvas;e.removeEventListener("wheel",this.handleWheel),e.removeEventListener("mousedown",this.startDragging),e.removeEventListener("mousemove",this.drag),e.removeEventListener("mouseup",this.stopDragging),e.removeEventListener("mouseleave",this.stopDragging),window.removeEventListener("resize",this.handleResize),e.removeEventListener("mousemove",this.handleCanvasHover),e.removeEventListener("click",this.handleCanvasClick)},methods:{startDragging(e){this.dragging=!0,this.startX=e.clientX-this.offsetX,this.startY=e.clientY-this.offsetY},drag(e){this.dragging&&(this.offsetX=e.clientX-this.startX,this.offsetY=e.clientY-this.startY,this.applyTransform())},stopDragging(){this.dragging=!1},applyTransform(){const e=this.$refs.previewCanvas;e.style.transform=`translate(${this.offsetX}px, ${this.offsetY}px)`},handleOpenClick(){this.$refs.fileInput.click()},handleZoomIn(){this.scale=Math.min(this.scale*1.2,3),this.updateCanvasSize()},handleZoomOut(){this.scale=Math.max(parseFloat((this.scale*.8).toFixed(2)),.2),this.updateCanvasSize()},updateCanvasSize(){const e=this.$refs.previewCanvas,s=50,a=Math.max(this.baseWidth*this.scale,s),l=Math.max(this.baseHeight*this.scale,s);e.style.width=`${a}px`,e.style.height=`${l}px`,this.$refs.predictor.drawBoxes(e)},async handleFileChange(e){const s=e.target.files[0];if(s){this.errorCheck=!1;const a=new FileReader;a.onload=l=>{const n=new Image;n.onload=()=>{this.baseWidth=n.naturalWidth,this.baseHeight=n.naturalHeight,this.$emit("image-size-update",{width:this.baseWidth,height:this.baseHeight});const o=this.$refs.previewCanvas;o.width=n.naturalWidth,o.height=n.naturalHeight,o.getContext("2d").drawImage(n,0,0,o.width,o.height),this.showPreview=!0,this.previewImage=l.target.result,this.$nextTick(()=>{this.$refs.predictor.detect(o)})},n.src=l.target.result},a.onerror=l=>{this.errorMessage=`文件加载失败: ${l.target.error.name}`,this.showPreview=!1},this.errorCheck||a.readAsDataURL(s)}},handleImageError(e){this.errorMessage="图片加载失败",this.showPreview=!1},handleImageLoad(){this.$nextTick(()=>{const e=this.$refs.previewImageRef.$el.querySelector("img");e&&this.$refs.predictor&&(e.onload=()=>{this.$refs.predictor.detect(e)},e.complete&&this.$refs.predictor.detect(e))})},handlePredictionsUpdate(e){this.boxCount=e,this.$emit("prediction-update",e)},loadSelectedImage(e){if(this.previewImage=e,this.showPreview=!0,e.startsWith("blob:"))this.$nextTick(()=>{this.$refs.predictor&&this.$refs.predictor.detectImage()});else{const s=new Image;s.onload=()=>{this.$nextTick(()=>{this.$refs.predictor&&this.$refs.predictor.detectImage()})},s.src=e}},simulateFileSelection(e){try{console.log("正在模拟文件选择:",e.name),this.handleFileChange({target:{files:[e]}})}catch(s){console.error("模拟文件选择失败:",s)}},handlePredictionsUpdate(e){this.boxCount=e,this.$emit("prediction-update",e)}}},H=Object.assign(ve,{__name:"Main",setup(e){return(s,a)=>{const l=d("el-button"),n=d("el-empty"),o=d("el-icon"),r=d("el-button-group"),p=d("el-affix");return w(),z(E,null,[_("div",me,[D(_("canvas",fe,null,512),[[I,s.showPreview]]),D(t(n,{class:"image-placeholder",description:s.errorMessage,style:{height:"100%"}},{default:i(()=>[t(l,{type:"primary",onClick:s.handleOpenClick},{default:i(()=>a[1]||(a[1]=[v("打开")])),_:1},8,["onClick"]),_("input",{ref:"fileInput",type:"file",hidden:"",onChange:a[0]||(a[0]=(...h)=>s.handleFileChange&&s.handleFileChange(...h))},null,544)]),_:1},8,["description"]),[[I,!s.showPreview]]),D(t(j,{ref:"predictor","image-src":s.previewImage,onPredictionUpdate:s.handlePredictionsUpdate},null,8,["image-src","onPredictionUpdate"]),[[I,s.showPreview]])]),D(_("div",ge,[t(p,{position:"bottom",offset:130},{default:i(()=>[t(r,{class:"picControl"},{default:i(()=>[t(l,{circle:"",onClick:s.handleZoomIn},{default:i(()=>[t(o,null,{default:i(()=>[t(y(q))]),_:1})]),_:1},8,["onClick"]),t(l,{type:"primary",circle:"",onClick:s.handleZoomOut},{default:i(()=>[t(o,null,{default:i(()=>[t(y(G))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})],512),[[I,s.showPreview]]),D(_("div",_e,[t(p,{position:"bottom",offset:130},{default:i(()=>[t(r,{class:"picControl"},{default:i(()=>[t(l,{circle:"",onClick:s.handleOpenClick},{default:i(()=>[t(o,null,{default:i(()=>[t(y(K))]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})],512),[[I,s.showPreview]])],64)}}}),we={name:"AppFooter",props:{imageDimensions:{type:Object,default:()=>({width:0,height:0})},boxCount:{type:Number,default:0}},computed:{imageSize(){return`${this.imageDimensions.width} × ${this.imageDimensions.height}`}}},be=Object.assign(we,{setup(e){return(s,a)=>{const l=d("el-col"),n=d("el-statistic"),o=d("el-icon"),r=d("el-row");return w(),$(r,null,{default:i(()=>[t(l,{span:6}),t(l,{span:6},{default:i(()=>[t(n,{title:"图像尺寸",value:s.imageSize},null,8,["value"]),t(o,null,{default:i(()=>[t(y(Q))]),_:1})]),_:1}),t(l,{span:6},{default:i(()=>[t(n,{title:"预测框数量",value:e.boxCount},null,8,["value"]),t(o,null,{default:i(()=>[t(y(J))]),_:1})]),_:1}),t(l,{span:6})]),_:1})}}}),M=O(be,[["__scopeId","data-v-edb9ebf5"]]),Y={__name:"SideBar",emits:["toggle-drawer"],setup(e,{emit:s}){const a=L(!0),l=s,n=()=>{l("toggle-drawer")};return(o,r)=>{const p=d("el-icon"),h=d("el-menu-item"),f=d("el-menu");return w(),$(f,{"default-active":"2",id:"sidebarContainer",collapse:a.value,"collapse-transition":!0},{default:i(()=>[t(h,{index:"1",onClick:n},{title:i(()=>r[1]||(r[1]=[v("预测文件夹")])),default:i(()=>[t(p,null,{default:i(()=>[t(y(ee))]),_:1})]),_:1}),t(h,{index:"2",disabled:""},{title:i(()=>r[2]||(r[2]=[v("训练分析")])),default:i(()=>[t(p,null,{default:i(()=>[t(y(te))]),_:1})]),_:1}),t(h,{index:"3",disabled:""},{title:i(()=>r[3]||(r[3]=[v("关于")])),default:i(()=>[t(p,null,{default:i(()=>[t(y(se))]),_:1})]),_:1}),r[4]||(r[4]=_("div",{class:"flexgrow"},null,-1)),t(h,{index:"5",class:"fixed-bottom expand-switch",onClick:r[0]||(r[0]=x=>a.value=!a.value)},{default:i(()=>[t(p,null,{default:i(()=>[a.value?(w(),$(y(ie),{key:0})):(w(),$(y(ne),{key:1}))]),_:1})]),_:1})]),_:1},8,["collapse"])}}},ye={class:"image-preview-tooltip"},Ce=["src"],$e={class:"filename-text"},xe={name:"AppDrawer",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"预测文件夹"},withHeader:{type:Boolean,default:!1},size:{type:String,default:"50%"},direction:{type:String,default:"rtl"}},emits:["update:visible","file-selected"],computed:{drawerVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}}},Se=Object.assign(xe,{emits:["update:visible","file-selected"],setup(e,{emit:s}){const a=L(""),l=L(null);X(()=>{o.value.forEach(u=>{u.path&&u.path.startsWith("blob:")&&URL.revokeObjectURL(u.path)})});const n=N(()=>o.value.filter(u=>!a.value||u.name.toLowerCase().includes(a.value.toLowerCase()))),o=L([]),r=(u,c)=>{console.log("查看图片:",c),f("file-selected",c.file),f("update:visible",!1)},p=(u,c)=>{console.log("删除图片:",c),o.value.splice(u,1)},h=()=>{l.value.click()},f=s,x=u=>{const c=u.target.files;!c||c.length===0||(o.value=[],Array.from(c).forEach(g=>{if(g.type==="image/jpeg"||g.name.toLowerCase().endsWith(".jpg")||g.name.toLowerCase().endsWith(".jpeg")){const b=URL.createObjectURL(g),C=g.webkitRelativePath,P=new Date(g.lastModified).toISOString().split("T")[0];o.value.push({date:P,name:g.name,path:b,relativePath:C,file:g})}}),u.target.value="")};return(u,c)=>{const g=d("el-tooltip"),b=d("el-table-column"),C=d("el-input"),S=d("el-button"),P=d("el-table"),F=d("el-drawer");return w(),$(F,{modelValue:u.drawerVisible,"onUpdate:modelValue":c[2]||(c[2]=m=>u.drawerVisible=m),title:e.title,"with-header":e.withHeader,size:e.size,direction:e.direction},{footer:i(()=>[t(S,{size:"small",onClick:c[1]||(c[1]=m=>u.drawerVisible=!1)},{default:i(()=>c[5]||(c[5]=[v("取消")])),_:1}),t(S,{type:"primary",size:"small",onClick:h},{default:i(()=>c[6]||(c[6]=[v("选择文件夹")])),_:1})]),default:i(()=>[t(P,{data:n.value,style:{width:"100%"}},{default:i(()=>[t(b,{label:"文件名",width:"170"},{default:i(m=>[t(g,{placement:"right",enterable:!1},{content:i(()=>[_("div",ye,[_("img",{src:m.row.path,alt:"预览",class:"preview-image"},null,8,Ce)])]),default:i(()=>[_("span",$e,U(m.row.name),1)]),_:2},1024)]),_:1}),t(b,{label:"日期",prop:"date",width:"120"}),t(b,{label:"路径",prop:"relativePath"}),t(b,{align:"right",width:"150"},{header:i(()=>[t(C,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=m=>a.value=m),size:"small",placeholder:"输入关键字搜索"},null,8,["modelValue"])]),default:i(m=>[t(S,{size:"small",onClick:k=>r(m.$index,m.row)},{default:i(()=>c[3]||(c[3]=[v("查看")])),_:2},1032,["onClick"]),t(S,{size:"small",type:"danger",onClick:k=>p(m.$index,m.row)},{default:i(()=>c[4]||(c[4]=[v("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),_("input",{ref_key:"folderInput",ref:l,type:"file",webkitdirectory:"",multiple:"",style:{display:"none"},onChange:x},null,544)]),_:1},8,["modelValue","title","with-header","size","direction"])}}}),T=O(Se,[["__scopeId","data-v-9132fefb"]]),ke={class:"common-layout"};console.log('👋 This message is being logged by "App.vue", included via Vite');const Le={name:"App",components:{AppHeader:W,AppMain:H,AppFooter:M,SideBar:Y,AppDrawer:T},data(){return{imageDimensions:{width:0,height:0},boxCount:0}},methods:{handleImageSizeUpdate(e){this.imageDimensions=e},handlePredictionsUpdate(e){console.log("App 接收到预测框数量：",e),this.boxCount=e}}},Pe=Object.assign(Le,{setup(e){const s=L(!1),a=L(null),l=()=>{s.value=!0},n=o=>{console.log("App接收到选中图片:",o),a.value=o};return(o,r)=>{const p=d("el-aside"),h=d("el-header"),f=d("el-main"),x=d("el-footer"),u=d("el-container");return w(),z("div",ke,[t(u,null,{default:i(()=>[t(p,{style:{width:"auto"}},{default:i(()=>[t(Y,{onToggleDrawer:l})]),_:1}),t(u,null,{default:i(()=>[t(h,{id:"appHeader"},{default:i(()=>[t(W)]),_:1}),t(f,null,{default:i(()=>[t(H,{onImageSizeUpdate:o.handleImageSizeUpdate,onPredictionUpdate:o.handlePredictionsUpdate,"selected-file":a.value},null,8,["onImageSizeUpdate","onPredictionUpdate","selected-file"])]),_:1}),t(x,{height:"auto",style:{margin:"10px","padding-bottom":"10px"}},{default:i(()=>[t(M,{"image-dimensions":o.imageDimensions,"box-count":o.boxCount},null,8,["image-dimensions","box-count"])]),_:1})]),_:1})]),_:1}),t(T,{visible:s.value,"onUpdate:visible":r[0]||(r[0]=c=>s.value=c),onFileSelected:n},null,8,["visible"])])}}}),V=Z(Pe);V.use(oe);V.mount("#app");
